<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N ‚Ä¢ PC - –°–±–æ—Ä–∫–∞ –ü–ö –Ω–∞ –∑–∞–∫–∞–∑</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="images/logo.png">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="logo">N ‚Ä¢ PC</div>
            <ul class="nav-links">
                <li><a href="index.html" class="active">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="about.html">–û –Ω–∞—Å</a></li>
                <li><a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
            </ul>
        </nav>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h1>–°–æ–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π –ü–ö</h1>
            <p>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ –ø–æ–¥ –≤–∞—à–∏ –∑–∞–¥–∞—á–∏</p>
            <button class="cta-button" onclick="location.href='builder.html'">–ù–∞—á–∞—Ç—å —Å–±–æ—Ä–∫—É ‚Üí</button>
        </div>
    </section>

    <section class="how-it-works">
        <h2>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
        <div class="steps">
            <div class="step">
                <div class="step-number">1</div>
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª–∏</h3>
                <p>–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ—Å—å, –¥–ª—è —á–µ–≥–æ –≤–∞–º –Ω—É–∂–µ–Ω –∫–æ–º–ø—å—é—Ç–µ—Ä</p>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <h3>–£–∫–∞–∂–∏—Ç–µ –±—é–¥–∂–µ—Ç</h3>
                <p>–°–æ–æ–±—â–∏—Ç–µ –Ω–∞–º –≤–∞—à—É –ø–ª–∞–Ω–∏—Ä—É–µ–º—É—é —Å—É–º–º—É</p>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <h3>–ü–æ–ª—É—á–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</h3>
                <p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ —Å –≤–∞—Ä–∏–∞–Ω—Ç–æ–º —Å–±–æ—Ä–∫–∏</p>
            </div>
        </div>
    </section>

    <!-- –õ–∞–π–≤ —á–∞—Ç -->
    <div id="live-chat" class="live-chat">
        <button class="chat-toggle" onclick="toggleChat()">
            <span id="chat-status-indicator">‚óè</span> 
            <span id="chat-toggle-text">üí¨ Live-—á–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</span>
        </button>
        <div class="chat-window">
            <div class="chat-header">
                <h3>
                    <span id="support-status">Live-—á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏</span>
                    <span id="online-status" style="color: #4caf50; font-size: 0.8rem; margin-left: 10px;"></span>
                </h3>
                <button class="close-chat" onclick="toggleChat()">√ó</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message system">
                    <p>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ N ‚Ä¢ PC!</p>
                    <p style="font-size: 0.9rem; margin-top: 5px;">–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å, –∏ –º—ã –ø–æ–º–æ–∂–µ–º —Å –≤—ã–±–æ—Ä–æ–º –ü–ö.</p>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å..." disabled>
                <button id="sendButton" onclick="sendMessage()" disabled>üì§</button>
            </div>
            <div class="chat-info" id="chatInfo" style="padding: 10px; font-size: 0.8rem; color: #666; text-align: center; border-top: 1px solid #333;">
                –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —á–∞—Ç—É...
            </div>
        </div>
    </div>

    <footer>
        <p>¬© 2023 N ‚Ä¢ PC. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    </footer>

    <script src="sounds.js"></script>
  <script>
    // Live-—á–∞—Ç —Å WebSocket
    let chatOpen = false;
    let ws = null;
    let isConnected = false;
    let supportOnline = false;
    let sessionId = null;
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–µ—Å—Å–∏–∏
    function generateSessionId() {
        if (!sessionId) {
            sessionId = 'client-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
            if (typeof localStorage !== 'undefined') {
                localStorage.setItem('chatSessionId', sessionId);
            }
        }
        return sessionId;
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebSocket
    function initWebSocket() {
        try {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º sessionId –∏–∑ localStorage –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π
            if (typeof localStorage !== 'undefined') {
                sessionId = localStorage.getItem('chatSessionId') || generateSessionId();
            } else {
                sessionId = generateSessionId();
            }
            
            ws = new WebSocket('ws://localhost:3000');
            
            ws.onopen = function() {
                console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —á–∞—Ç—É');
                isConnected = true;
                updateConnectionStatus(true);
            };
            
            ws.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'support_status') {
                        supportOnline = data.online;
                        updateSupportStatus(data.online);
                    }
                    
                    if (data.type === 'message') {
                        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
                        addMessage(data.text, data.sender, data.timestamp);
                        
                        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –ø—Ä–∏ –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–ª–∏ —Å–∏—Å—Ç–µ–º—ã
                        if (typeof playNotificationSound === 'function' && (data.sender === 'support' || data.sender === 'system')) {
                            playNotificationSound();
                        }
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', e);
                }
            };
            
            ws.onclose = function() {
                console.log('‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —á–∞—Ç–∞');
                isConnected = false;
                updateConnectionStatus(false);
                
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(initWebSocket, 3000);
            };
            
            ws.onerror = function(error) {
                console.error('–û—à–∏–±–∫–∞ WebSocket:', error);
                updateConnectionStatus(false);
            };
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ WebSocket:', error);
            updateConnectionStatus(false);
        }
    }
    
    function updateConnectionStatus(connected) {
        const statusEl = document.getElementById('chatInfo');
        const input = document.getElementById('chatInput');
        const button = document.getElementById('sendButton');
        const indicator = document.getElementById('chat-status-indicator');
        
        if (connected) {
            statusEl.innerHTML = '‚úÖ –ß–∞—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω' + (supportOnline ? ' | üë®‚Äçüíª –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–Ω–ª–∞–π–Ω' : ' | ‚è≥ –û–∂–∏–¥–∞–π—Ç–µ –æ—Ç–≤–µ—Ç–∞');
            statusEl.style.color = '#4caf50';
            indicator.style.color = '#4caf50';
            input.disabled = false;
            button.disabled = false;
            input.placeholder = '–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å...';
        } else {
            statusEl.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —á–∞—Ç—É. –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            statusEl.style.color = '#ff4444';
            indicator.style.color = '#ff4444';
            input.disabled = true;
            button.disabled = true;
            input.placeholder = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
        }
    }
    
    function updateSupportStatus(online) {
        const statusEl = document.getElementById('online-status');
        const infoEl = document.getElementById('chatInfo');
        
        if (online) {
            statusEl.textContent = 'üë®‚Äçüíª –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–Ω–ª–∞–π–Ω';
            statusEl.style.color = '#4caf50';
        } else {
            statusEl.textContent = '‚è≥ –û–∂–∏–¥–∞–π—Ç–µ –æ—Ç–≤–µ—Ç–∞';
            statusEl.style.color = '#ffa726';
        }
    }
    
    function toggleChat() {
        const chat = document.getElementById('live-chat');
        chatOpen = !chatOpen;
        
        if (chatOpen) {
            chat.classList.add('open');
            if (typeof playClickSound === 'function') playClickSound();
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
            setTimeout(() => {
                document.getElementById('chatInput').focus();
            }, 100);
        } else {
            chat.classList.remove('open');
        }
    }
    
    function sendMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        
        if (!message || !isConnected || !ws) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —á–∞—Ç—É');
            return;
        }
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ WebSocket
        ws.send(JSON.stringify({
            type: 'client_message',
            text: message,
            timestamp: new Date().toLocaleTimeString('ru-RU'),
            sessionId: sessionId
        }));
        
        // –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        input.value = '';
        
        // –ó–≤—É–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏
        if (typeof playClickSound === 'function') {
            playClickSound();
        }
    }
    
    function addMessage(text, sender, timestamp = null) {
        const messagesDiv = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è
        if (sender === 'system') {
            messageDiv.className = 'message system';
        } else if (sender === 'support') {
            messageDiv.className = 'message assistant';
        } else if (sender === 'user') {
            messageDiv.className = 'message user';
        } else {
            messageDiv.className = 'message';
        }
        
        const time = timestamp || new Date().toLocaleTimeString('ru-RU', { 
            hour: '2-digit', 
            minute: '2-digit' 
        });
        
        let senderName = '–í—ã';
        let avatar = 'üë§';
        
        if (sender === 'support') {
            senderName = '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ N ‚Ä¢ PC';
            avatar = 'üë®‚Äçüíª';
        } else if (sender === 'system') {
            senderName = '–°–∏—Å—Ç–µ–º–∞';
            avatar = 'ü§ñ';
        }
        
        messageDiv.innerHTML = `
            <div style="display: flex; align-items: center; margin-bottom: 5px;">
                <span style="font-size: 1.2rem; margin-right: 8px;">${avatar}</span>
                <strong style="color: ${sender === 'support' ? '#4caf50' : sender === 'system' ? '#ffa726' : '#ffffff'}">
                    ${senderName}
                </strong>
                <small style="color: #666; margin-left: 10px;">${time}</small>
            </div>
            <p>${text}</p>
        `;
        
        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ Enter
    document.getElementById('chatInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º WebSocket –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        initWebSocket();
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        setTimeout(() => {
            if (isConnected) {
                addMessage('üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ N ‚Ä¢ PC! –ó–∞–¥–∞–π—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å, –∏ –º—ã –ø–æ–º–æ–∂–µ–º –≤–∞–º —Å –≤—ã–±–æ—Ä–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–∞.', 'system');
            }
        }, 1000);
        
        // –ê–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞ —á–µ—Ä–µ–∑ 20 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            if (!chatOpen && document.visibilityState === 'visible') {
                toggleChat();
            }
        }, 20000);
    });
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    document.addEventListener('click', function(event) {
        const chat = document.getElementById('live-chat');
        const chatWindow = document.querySelector('.chat-window');
        const toggleBtn = document.querySelector('.chat-toggle');
        
        if (chatOpen && 
            !chatWindow.contains(event.target) && 
            !toggleBtn.contains(event.target) &&
            chatWindow !== event.target) {
            toggleChat();
        }
    });
</script>
</body>
</html>