<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —á–∞—Ç–∞</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #0a0a0a; color: white; }
        button { padding: 10px 20px; background: #0088cc; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 10px; }
        button:hover { background: #006699; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #2e7d32; }
        .error { background: #c62828; }
        .info { background: #1565c0; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–∞—Ç–∞ –≤ Telegram</h1>
    
    <div>
        <button onclick="testChat()">üì® –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–∞—Ç–∞</button>
        <button onclick="testWebSocket()">üîå –¢–µ—Å—Ç WebSocket</button>
        <button onclick="testTelegram()">ü§ñ –¢–µ—Å—Ç Telegram</button>
    </div>
    
    <div>
        <input type="text" id="message" placeholder="–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" value="–ü—Ä–∏–≤–µ—Ç! –¢–µ—Å—Ç–∏—Ä—É—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–∞—Ç–∞" style="width: 300px; padding: 8px;">
        <button onclick="sendLiveMessage()">üí¨ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
    </div>
    
    <div id="result"></div>

    <script>
    function showResult(text, type = 'info') {
        const div = document.getElementById('result');
        div.innerHTML = `<div class="result ${type}">${text}</div>`;
    }
    
    async function testChat() {
        showResult('üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è...', 'info');
        
        try {
            const response = await fetch('/api/orders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name: '–¢–µ—Å—Ç –ß–∞—Ç',
                    phone: '+79991112233',
                    email: 'test@chat.com',
                    purpose: '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
                    budget: '1000',
                    components: '–¢–µ—Å—Ç',
                    comment: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–∞—Ç–∞'
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                showResult(`‚úÖ –ó–∞—è–≤–∫–∞ #${data.orderId} —Å–æ–∑–¥–∞–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram`, 'success');
            } else {
                showResult(`‚ùå –û—à–∏–±–∫–∞: ${data.message}`, 'error');
            }
        } catch (error) {
            showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
        }
    }
    
    function testWebSocket() {
        showResult('üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket...', 'info');
        
        const ws = new WebSocket('ws://localhost:3000');
        
        ws.onopen = () => {
            showResult('‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
            ws.close();
        };
        
        ws.onerror = () => {
            showResult('‚ùå –û—à–∏–±–∫–∞ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
        };
        
        setTimeout(() => {
            if (ws.readyState === 0) {
                showResult('‚ùå –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WebSocket', 'error');
            }
        }, 3000);
    }
    
    async function testTelegram() {
        showResult('üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram –±–æ—Ç–∞...', 'info');
        
        try {
            const response = await fetch('/api/test');
            const data = await response.json();
            
            if (data.telegram) {
                showResult('‚úÖ Telegram –±–æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω!', 'success');
            } else {
                showResult('‚ö†Ô∏è Telegram –±–æ—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω', 'error');
            }
        } catch (error) {
            showResult(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
        }
    }
    
    function sendLiveMessage() {
        const message = document.getElementById('message').value;
        showResult('üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —á–∞—Ç—É...', 'info');
        
        const ws = new WebSocket('ws://localhost:3000');
        
        ws.onopen = () => {
            showResult('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ, –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è...', 'info');
            
            ws.send(JSON.stringify({
                type: 'client_message',
                text: message,
                timestamp: new Date().toLocaleTimeString('ru-RU')
            }));
            
            setTimeout(() => {
                showResult('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:<br>1. –ö–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞<br>2. Telegram<br>3. chat-admin.html', 'success');
                ws.close();
            }, 1000);
        };
        
        ws.onerror = () => {
            showResult('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —á–∞—Ç—É', 'error');
        };
    }
    </script>
</body>
</html>